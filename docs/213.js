(()=>{"use strict";var e,t,r={4213:(e,t,r)=>{function n(e,t){return null==e?t:e[0]}function a(e){return null!=e}function o(e){return[e]}function i(e){return null==e?null:[e]}function u(e,t){return a(e)?[t(e[0])]:null}function s(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=p(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw o}}}}function c(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o=[],i=!0,u=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){u=!0,a=e}finally{try{i||null==r.return||r.return()}finally{if(u)throw a}}return o}}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(e,t):void 0}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e,t){for(var r=0;r<e.length&&r<t.length;++r){var n=e[r],a=t[r];if(n!==a)return a===1/0?-1:n===1/0?1:null==n?-1:null==a?1:n<a?-1:1}return e.length===t.length?0:e.length>t.length?1:-1}function v(e,t,r){for(var n,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.length;a<o;)r(t,e[n=a+o>>>1])>0?a=n+1:o=n;return a}r(5666);var m=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};h(this,e),this.mainIndexName=t,this.indexKeyers=r,this.indexDependentGroup=n,this.indexGroupKeyers=a,this.indexReducers=o}var t,r,n;return t=e,n=[{key:"iterator",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=e.getRangeFrom(t,r,n),i=a.startIdx,u=a.endIdx,s=i;return function(){return s<u?o(t[1][s++]):null}}},{key:"reverseIter",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;r&&(r=x(r)),n&&(n=x(n));var a=e.getRangeFrom(t,n,r),i=a.startIdx,u=a.endIdx,s=u;return function(){return s>i?o(t[1][--s]):null}}},{key:"getAllMatching",value:function(t,r){var n=e.getRangeFrom(t,r,I(r)),a=n.startIdx,o=n.endIdx;return t[1].slice(a,o)}},{key:"getRangeFrom",value:function(e){var t=f(e,1),r=t[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return{startIdx:null==n?0:v(r,n,g),endIdx:null==a?r.length:v(r,a,g)}}},{key:"getFirstMatching",value:function(t,r){return e.iterator(t,r,I(r))()}}],(r=[{key:"pkKeyer",get:function(){return this.indexKeyers[this.mainIndexName]}},{key:"setKeyer",value:function(e,t){this.indexKeyers[e]=t}},{key:"addGroupedIndex",value:function(e,t,r,n,a){if(!this.indexKeyers[r])throw new Error("Dependent index "+r+" should be defined before "+e);this.setKeyer(e,t),this.indexDependentGroup[e]=r,this.indexGroupKeyers[e]=n,this.indexReducers[e]=a}},{key:"empty",value:function(){var e={};for(var t in this.indexKeyers)e[t]=[[],[]];return e}},{key:"removeAll",value:function(e,t){return this.splice(e,t,[])}},{key:"removeByPk",value:function(t,r){return this.removeAll(t,e.getAllMatching(t[this.mainIndexName],r))}},{key:"update",value:function(t,r){var n=this,a=[],o=[],i=f(w(this.indexKeyers[this.mainIndexName],r),2),s=i[0];return i[1].forEach((function(r,i){u(e.getFirstMatching(t[n.mainIndexName],s[i]),(function(e){return a.push(e)})),o.push(r)})),this.splice(t,a,o)}},{key:"splice",value:function(t,r,n){var a=this,o=t;if(!r.length&&!n.length)return t;t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t);for(var i=function(){var i=p[f],l=t[i],d=r,y=n,h=a.indexDependentGroup[i];if(h){var b=a.indexGroupKeyers[i],g=a.indexReducers[i],v=w(b,[].concat(c(d),c(y)));d=[],y=[];var m,x=s(v[0]);try{for(x.s();!(m=x.n()).done;){var k=m.value,A=o[h],O=I(k),R=e.iterator(A,k,O),j=e.reverseIter(A,O,k),P=g(R,j),z=t[h],N=g(R=e.iterator(z,k,O),j=e.reverseIter(z,O,k));P!==N&&(u(P,(function(e){return d.push(e)})),u(N,(function(e){return y.push(e)})))}}catch(e){x.e(e)}finally{x.f()}}if(!y.length&&!d.length)return"continue";l=t[i]=[c(l[0]),c(l[1])];var M,S=s(d);try{for(S.s();!(M=S.n()).done;){var K=M.value;a.removeFromIndex(l,i,K)}}catch(e){S.e(e)}finally{S.f()}var C,T=s(y);try{for(T.s();!(C=T.n()).done;){var D=C.value;a.addToIndex(l,i,D)}}catch(e){T.e(e)}finally{T.f()}},f=0,p=Object.keys(this.indexKeyers);f<p.length;f++)i();return t}},{key:"strictValueKeyOf",value:function(e,t){var r=this.indexKeyers[this.mainIndexName](t);return e===this.mainIndexName?r:[].concat(c(this.indexKeyers[e](t)),c(r))}},{key:"addToIndex",value:function(t,r,n){var a=this.strictValueKeyOf(r,n),o=e.getRangeFrom(t,a).startIdx;t[0].splice(o,0,a),t[1].splice(o,0,n)}},{key:"removeFromIndex",value:function(t,r,n){var a=this.strictValueKeyOf(r,n),o=e.getRangeFrom(t,a,x(a)),i=o.startIdx,u=o.endIdx;t[0].splice(i,u-i),t[1].splice(i,u-i)}}])&&b(t.prototype,r),n&&b(t,n),e}();function w(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[[],[]],a=s(t);try{for(a.s();!(r=a.n()).done;){var o=r.value,i=e(o),u=m.getRangeFrom(n,i,x(i)),c=u.startIdx,l=u.endIdx;n[0].splice(c,l-c,i),n[1].splice(c,l-c,o)}}catch(e){a.e(e)}finally{a.f()}return n}function x(e){return[].concat(c(e),[null])}function I(e){return[].concat(c(e),[1/0])}function k(e){return function(e){if(Array.isArray(e))return O(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||A(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){if(e){if("string"==typeof e)return O(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?O(e,t):void 0}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function R(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?R(Object(r),!0).forEach((function(t){P(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var z={attributes:{content:"",language:"",editsComplete:!1,terms:void 0,audioFileId:null,tags:[]},id:"",path:"",version:""},N=j(j({},z),{},{attributes:j(j({},z.attributes),{},{terms:[]}),id:void 0,path:void 0,version:void 0}),M={noteId:"",language:"",attributes:{reference:"",marker:"",pronounce:"",definition:"",hint:"",clozes:void 0,related:[]}},S=j(j({},M),{},{attributes:j(j({},M.attributes),{},{clozes:[]}),noteId:void 0,language:void 0}),K={noteId:"",reference:"",marker:"",clozeIdx:-1,language:"",attributes:{type:"produce",clozed:"",schedule:{lastAnsweredMinutes:0,nextDueMinutes:0,delayIntervalMinutes:0,intervalMinutes:0,isNew:!0}}},C=(j(j({},K),{},{attributes:j(j({},K.attributes),{},{answers:[]}),noteId:void 0,reference:void 0,marker:void 0,clozeIdx:void 0,language:void 0}),"\n===\n");function T(e){var t=j({},N);t.attributes=j({},N.attributes);var r=e.lastIndexOf(C);return-1!==r?(t.attributes=j(j({},t.attributes),JSON.parse(e.slice(r+C.length))),t.attributes.content=e.slice(0,r),t.attributes.terms=t.attributes.terms.map((function(e){return j(j({},e),{},{attributes:j(j({},S.attributes),e.attributes)})}))):t.attributes.content=e,t}function D(e,t){return{inner:e,tag:t}}var E=new m("byLanguageTagAndNoteId");E.setKeyer("byLanguageTagAndNoteId",(function(e){var t=e.tag,r=e.inner;return[r.attributes.language,t,r.id]})),E.setKeyer("byNoteId",(function(e){return[e.inner.id]})),E.addGroupedIndex("byLangAndTagOfFirstNoteId",(function(e){var t=e.tag;return[e.inner.attributes.language,t]}),"byLanguageTagAndNoteId",(function(e){var t=e.tag;return[e.inner.attributes.language,t]}),(function(e){return e()}));var F=new m("byPath");F.setKeyer("byPath",(function(e){return e.path.split("/")})),F.setKeyer("byId",(function(e){return[e.id]})),F.setKeyer("byLanguage",(function(e){return[e.attributes.language]})),F.setKeyer("byAudioFileId",(function(e){return[e.attributes.audioFileId]})),F.setKeyer("byEditsComplete",(function(e){return[e.attributes.editsComplete]}));var B=new m("byNoteIdReferenceAndMarker");B.setKeyer("byNoteIdReferenceAndMarker",(function(e){return[e.noteId,e.attributes.reference,e.attributes.marker]}));var L=new m("byNoteIdReferenceMarkerAndTag");L.setKeyer("byNoteIdReferenceMarkerAndTag",(function(e){var t=e.inner,r=e.tag;return[].concat(k(B.pkKeyer(t)),[r])})),L.setKeyer("byTag",(function(e){return e.inner,[e.tag]}));var q=new m("byNoteIdReferenceMarkerAndClozeIdx");q.setKeyer("byNoteIdReferenceMarkerAndClozeIdx",(function(e){return[e.noteId,e.reference,e.marker,e.clozeIdx]})),q.setKeyer("byNoteIdReferenceMarkerAndNextDue",(function(e){return[e.noteId,e.reference,e.marker,e.attributes.schedule.nextDueMinutes]})),q.setKeyer("byNoteIdReferenceMarkerAndNextDue",(function(e){return[e.noteId,e.reference,e.marker,e.attributes.schedule.nextDueMinutes]}));var G=new m("byNoteIdReferenceMarkerClozeIdxAndTag");G.setKeyer("byNoteIdReferenceMarkerClozeIdxAndTag",(function(e){var t=e.inner,r=e.tag;return[].concat(k(q.pkKeyer(t)),[r])})),G.setKeyer("byTagSpokenAndNextDue",(function(e){var t=e.inner;return[e.tag,"listen"==t.attributes.type||"speak"==t.attributes.type,!t.attributes.schedule.delayIntervalMinutes,t.attributes.schedule.nextDueMinutes]})),G.setKeyer("byTagSpokenNewAndNextDue",(function(e){var t=e.inner;return[e.tag,"listen"==t.attributes.type||"speak"==t.attributes.type,t.attributes.schedule.isNew,!t.attributes.schedule.delayIntervalMinutes,t.attributes.schedule.nextDueMinutes]})),G.setKeyer("byTagSpokenReferenceAndNextDue",(function(e){var t=e.inner;return[e.tag,"listen"==t.attributes.type||"speak"==t.attributes.type,t.reference,t.attributes.schedule.nextDueMinutes]}));var $=new m("byNoteIdReferenceMarkerClozeIdxAndAnswerIdx");$.setKeyer("byNoteIdReferenceMarkerClozeIdxAndAnswerIdx",(function(e){return[e.noteId,e.reference,e.marker,e.clozeIdx,e.answerIdx>0?1:0]}));var U=new m("byNoteIdReferenceMarkerClozeIdxAnswerIdxAndTag");function V(e,t,r,n){var a,o=j(j({},e),{},{attributes:j(j({},e.attributes),{},{terms:void 0}),id:t,path:r,version:n}),i=[],u=[],s=[],c={note:o,terms:i,clozes:u,clozeAnswers:s},l=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=A(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw o}}}}(e.attributes.terms);try{for(l.s();!(a=l.n()).done;){var d=a.value,f=j(j({},d),{},{attributes:j(j({},d.attributes),{},{clozes:void 0}),language:o.attributes.language,noteId:o.id});i.push(f);for(var p=0;p<d.attributes.clozes.length;++p){var y=d.attributes.clozes[p],h=j(j({},y),{},{clozeIdx:p,marker:f.attributes.marker,reference:f.attributes.reference,language:o.attributes.language,noteId:o.id});u.push(h);for(var b=0;b<y.attributes.answers.length;++b){var g={answer:y.attributes.answers[b],answerIdx:b,clozeIdx:p,marker:f.attributes.marker,reference:f.attributes.reference,language:o.attributes.language,noteId:o.id};s.push(g)}}}}catch(e){l.e(e)}finally{l.f()}return c}U.setKeyer("byNoteIdReferenceMarkerClozeIdxAnswerIdxAndTag",(function(e){var t=e.inner,r=e.tag;return[].concat(k($.pkKeyer(t)),[r])})),U.setKeyer("byTagAndAnswered",(function(e){var t=e.inner;return[e.tag,t.answer[0]]})),$.addGroupedIndex("byLastAnsweredOfNoteIdReferenceMarkerAndClozeIdx",(function(e){return[e.answer[0]]}),"byNoteIdReferenceMarkerClozeIdxAndAnswerIdx",(function(e){return[e.noteId,e.reference,e.marker,e.clozeIdx]}),(function(e,t){return t()}));var J={notes:F.empty(),terms:B.empty(),clozes:q.empty(),clozeAnswers:$.empty(),taggedNotes:E.empty(),taggedTerms:L.empty(),taggedClozes:G.empty(),taggedClozeAnswers:U.empty()};function H(e){for(var t=[],r=[],n=[],a=[],o=[],i=[],u=[],s=[],c=arguments.length,l=new Array(c>1?c-1:0),d=1;d<c;d++)l[d-1]=arguments[d];for(var f=function(){var c=y[p];t.push(c.note),r.push.apply(r,k(c.terms)),n.push.apply(n,k(c.clozes)),a.push.apply(a,k(c.clozeAnswers)),[c.note.attributes.language].concat(k(c.note.attributes.tags)).forEach((function(e){o.push(D(c.note,e)),i.push.apply(i,k(c.terms.map((function(t){return D(t,e)})))),u.push.apply(u,k(c.clozes.map((function(t){return D(t,e)})))),s.push.apply(s,k(c.clozeAnswers.map((function(t){return D(t,e)}))))})),e.taggedNotes=E.removeAll(e.taggedNotes,m.getAllMatching(e.taggedNotes.byNoteId,[c.note.id])),e.taggedTerms=L.removeAll(e.taggedTerms,m.getAllMatching(e.taggedTerms.byNoteIdReferenceMarkerAndTag,[c.note.id])),e.taggedClozes=G.removeAll(e.taggedClozes,m.getAllMatching(e.taggedClozes.byNoteIdReferenceMarkerClozeIdxAndTag,[c.note.id])),e.taggedClozeAnswers=U.removeAll(e.taggedClozeAnswers,m.getAllMatching(e.taggedClozeAnswers.byNoteIdReferenceMarkerClozeIdxAnswerIdxAndTag,[c.note.id])),e.terms=B.removeByPk(e.terms,[c.note.id]),e.clozes=q.removeByPk(e.clozes,[c.note.id]),e.clozeAnswers=$.removeByPk(e.clozeAnswers,[c.note.id])},p=0,y=l;p<y.length;p++)f();e.notes=F.update(e.notes,t),e.terms=B.update(e.terms,r),e.clozes=q.update(e.clozes,n),e.clozeAnswers=$.update(e.clozeAnswers,a),e.taggedNotes=E.update(e.taggedNotes,o),e.taggedClozes=G.update(e.taggedClozes,u),e.taggedTerms=L.update(e.taggedTerms,i),e.taggedClozeAnswers=U.update(e.taggedClozeAnswers,s)}function Q(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function W(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Q(o,n,a,i,u,"next",e)}function u(e){Q(o,n,a,i,u,"throw",e)}i(void 0)}))}}function X(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Y(e,t,r){return t&&X(e.prototype,t),r&&X(e,r),e}function Z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ee=function e(){var t=this;Z(this,e),_(this,"resolve",(function(){return null})),_(this,"reject",(function(){return null})),_(this,"promise",new Promise((function(e,r){t.resolve=e,t.reject=r})))},te=function(){function e(){Z(this,e),_(this,"trigger",new ee),_(this,"closed",!1)}var t;return Y(e,[{key:"send",value:function(e){this.closed||(this.trigger.resolve(e),this.trigger=new ee)}},{key:"reject",value:function(e){this.closed||(this.trigger.reject(e),this.trigger=new ee)}},{key:"receive",value:(t=W(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.trigger.promise;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(e){this.trigger.resolve(e),this.closed=!0}}]),e}(),re=function(){function e(){Z(this,e),_(this,"channel",new te),_(this,"open",!0)}var t;return Y(e,[{key:"ready",value:(t=W(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.open){e.next=11;break}return this.open=!1,e.prev=3,e.next=6,t();case 6:return e.abrupt("return",e.sent);case 7:return e.prev=7,this.channel.send(),this.open=!0,e.finish(7);case 11:return e.next=13,this.channel.receive();case 13:e.next=0;break;case 15:case"end":return e.stop()}}),e,this,[[3,,7,11]])}))),function(e){return t.apply(this,arguments)})}]),e}();function ne(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function ae(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){ne(o,n,a,i,u,"next",e)}function u(e){ne(o,n,a,i,u,"throw",e)}i(void 0)}))}}function oe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ie(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ue(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(r),!0).forEach((function(t){se(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ie(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function se(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ce(e){var t=e.split(".");return t.length>0?o(t[t.length-1]):null}var le=ue(ue(ue({},{mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",opus:"audio/opus"}),{text:"text/plain; charset=UTF-8"}),{mp4:"video/mp4",ogg:"video/ogg"}),de=new m("byId");function fe(e){return new Promise((function(t,r){var n=new FileReader;n.onload=function(){return t(n.result)},n.onerror=function(e){return r(n.error)},n.readAsText(e)}))}function pe(e){return e instanceof Blob?e:new Blob([e.data],{type:e.type})}function ye(e){return new Promise((function(t,r){var n=new FileReader;n.onload=function(){return t(n.result)},n.onerror=r,n.readAsArrayBuffer(e)}))}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function be(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ge(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?be(Object(r),!0).forEach((function(t){ve(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):be(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ve(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function me(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function we(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){me(o,n,a,i,u,"next",e)}function u(e){me(o,n,a,i,u,"throw",e)}i(void 0)}))}}de.setKeyer("byPath",(function(e){return e.path.split("/")})),de.setKeyer("byId",(function(e){return[e.id]}));var xe=new(function(){function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),se(this,"writeSemaphore",new re),se(this,"dirtyIndex",de.empty()),this.db=t,this.db.version(2).stores({cursors:"&backend",metadata:"&id,path,dirty,ext",blobs:"&id,path,ext,dirty"}),this.dirtiesLoaded=this.db.table("blobs").where("dirty").equals(1).toArray().then((function(e){r.dirtyIndex=de.update(r.dirtyIndex,e)}))}var t,r,o,u,s,c,l,d,f,p,y,h,b,g;return t=e,(r=[{key:"markDeleted",value:(g=ae(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.table("metadata").where("id").equals(t).first();case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return");case 5:return r=ue(ue({},r),{},{dirty:1,updatedAt:Date.now(),deleted:!0}),e.next=8,this.storeBlobAndMetadata(r,new Blob);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"replaceFromDirty",value:function(e){var t={};return this.dirtyIndex.byId[1].map((function(e){t[e.id]=e})),e.map((function(e){return e.id in t?t[e.id]:e}))}},{key:"fetchDirty",value:(b=ae(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dirtiesLoaded;case 2:return e.abrupt("return",this.dirtyIndex.byId[1]);case 3:case"end":return e.stop()}}),e,this)}))),function(){return b.apply(this,arguments)})},{key:"clear",value:(h=ae(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.dirtyIndex=de.empty(),e.next=3,this.dirtiesLoaded;case 3:return e.next=5,this.writeSemaphore.ready(ae(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.db.table("metadata").clear();case 2:return e.next=4,t.db.table("blobs").clear();case 4:return e.next=6,t.db.table("cursors").clear();case 6:case"end":return e.stop()}}),e)}))));case 5:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"storeCursor",value:(y=ae(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.writeSemaphore.ready(ae(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.db.table("cursors").put({backend:"default",cursor:t});case 2:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"getCursor",value:(p=ae(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.table("cursors").where("backend").equals("default").first();case 2:return t=e.sent,e.abrupt("return",(null==t?void 0:t.cursor)||"");case 4:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"storeBlob",value:(f=ae(regeneratorRuntime.mark((function e(t,r,a){var o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n(ce(r.path),""),i=ue(ue({},r),{},{ext:o,dirty:a?1:0,updatedAt:Date.now()}),e.next=4,this.storeBlobAndMetadata(i,t);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return f.apply(this,arguments)})},{key:"storeBlobAndMetadata",value:(d=ae(regeneratorRuntime.mark((function e(t,r){var o,u,s,c,l,d=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye(r);case 2:return o=e.sent,u=n((f=t.path,p=void 0,y=void 0,y=function(e){return i(le[e.toLowerCase()])},a(p=ce(f))?y(p[0]):null),r.type),s={data:o,type:u,size:r.size},c=ue(ue({},t),{},{blob:s}),e.next=8,this.dirtiesLoaded;case 8:if(l=this.writeSemaphore.ready(ae(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.db.transaction("rw!","metadata","blobs",ae(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.db.table("metadata").put(t);case 2:return e.next=4,d.db.table("blobs").put(c);case 4:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)})))),!t.dirty){e.next=12;break}return this.dirtyIndex=de.update(this.dirtyIndex,[c]),e.abrupt("return");case 12:return this.dirtyIndex=de.removeByPk(this.dirtyIndex,[c.id]),e.next=15,l;case 15:case"end":return e.stop()}var f,p,y}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"deleteId",value:(l=ae(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dirtiesLoaded;case 2:return this.dirtyIndex=de.removeByPk(this.dirtyIndex,[t]),e.next=5,this.writeSemaphore.ready(ae(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.db.transaction("rw!","metadata","blobs",ae(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.db.table("blobs").where("id").equals(t).delete();case 2:return e.next=4,r.db.table("metadata").where("id").equals(t).delete();case 4:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)}))));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"deletePath",value:(c=ae(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dirtiesLoaded;case 2:return this.dirtyIndex=de.removeAll(this.dirtyIndex,m.getAllMatching(this.dirtyIndex.byPath,t.split("/"))),e.next=5,this.writeSemaphore.ready(ae(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.db.transaction("rw!","metadata","blobs",ae(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.db.table("metadata").where("path").between(t,t+"￾",!0,!1).delete();case 2:return e.next=4,r.db.table("blobs").where("path").between(t,t+"￾",!0,!1).delete();case 4:return e.next=6,r.db.table("metadata").where("path").equalsIgnoreCase(t).delete();case 6:return e.next=8,r.db.table("blobs").where("path").equalsIgnoreCase(t).delete();case 8:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)}))));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"fetchBlob",value:(s=ae(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=m.getFirstMatching(this.dirtyIndex.byId,[t]))){e.next=3;break}return e.abrupt("return",Promise.resolve(r));case 3:return e.abrupt("return",this.db.table("blobs").where("id").equals(t).first().then(i));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"fetchBlobsByExt",value:(u=ae(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.db.table("blobs").where("ext").equals(t).toArray().then((function(e){return r.replaceFromDirty(e)})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"fetchMetadataByExts",value:(o=ae(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.db.table("metadata").where("ext").anyOf(t).toArray().then((function(e){return r.replaceFromDirty(e)})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})}])&&oe(t.prototype,r),e}())(new(r(9642).default)("benSrsNew")),Ie=self;Ie.onmessage=we(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=ge({},J),e.next=4,xe.fetchBlobsByExt("txt");case 4:return r=e.sent,e.next=7,Promise.all(r.map(function(){var e=we(regeneratorRuntime.mark((function e(t){var r,n,a,o,i,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.blob,n=t.id,a=t.rev,o=t.path,e.next=3,fe(pe(r));case 3:return i=e.sent,u=T(i),e.abrupt("return",V(u,n,o,a));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 7:n=e.sent,H.apply(void 0,[t].concat(function(e){if(Array.isArray(e))return he(e)}(a=n)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(a)||function(e,t){if(e){if("string"==typeof e)return he(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?he(e,t):void 0}}(a)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())),Ie.postMessage({indexes:t}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error(e.t0);case 15:case"end":return e.stop()}var a}),e,null,[[0,12]])})))}},n={};function a(e){var t=n[e];if(void 0!==t)return t.exports;var o=n[e]={exports:{}};return r[e](o,o.exports,a),o.exports}a.m=r,a.x=()=>{var e=a.O(void 0,[160],(()=>a(4213)));return a.O(e)},e=[],a.O=(t,r,n,o)=>{if(!r){var i=1/0;for(c=0;c<e.length;c++){for(var[r,n,o]=e[c],u=!0,s=0;s<r.length;s++)(!1&o||i>=o)&&Object.keys(a.O).every((e=>a.O[e](r[s])))?r.splice(s--,1):(u=!1,o<i&&(i=o));u&&(e.splice(c--,1),t=n())}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[r,n,o]},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,r)=>(a.f[r](e,t),t)),[])),a.u=e=>e+".js",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={213:1};a.f.i=(t,r)=>{e[t]||importScripts(a.p+a.u(t))};var t=self.webpackChunk=self.webpackChunk||[],r=t.push.bind(t);t.push=t=>{var[n,o,i]=t;for(var u in o)a.o(o,u)&&(a.m[u]=o[u]);for(i&&i(a);n.length;)e[n.pop()]=1;r(t)}})(),t=a.x,a.x=()=>a.e(160).then(t),a.x()})();