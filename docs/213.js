(()=>{"use strict";var e,t,r={4213:(e,t,r)=>{function n(e,t){return null==e?t:e[0]}function a(e){return null!=e}function i(e){return[e]}function o(e){return null==e?null:[e]}function u(e,t){return a(e)?[t(e[0])]:null}function s(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=f(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw i}}}}function c(e){return function(e){if(Array.isArray(e))return p(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||f(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,i=[],o=!0,u=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){u=!0,a=e}finally{try{o||null==r.return||r.return()}finally{if(u)throw a}}return i}}(e,t)||f(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){if(e){if("string"==typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(e,t):void 0}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function g(e,t){for(var r=0;r<e.length&&r<t.length;++r){var n=e[r],a=t[r];if(n!==a)return a===1/0?-1:n===1/0?1:null==n?-1:null==a?1:n<a?-1:1}return e.length===t.length?0:e.length>t.length?1:-1}function v(e,t,r){for(var n,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.length;a<i;)r(t,e[n=a+i>>>1])>0?a=n+1:i=n;return a}r(5666);var m=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};y(this,e),this.mainIndexName=t,this.indexKeyers=r,this.indexDependentGroup=n,this.indexGroupKeyers=a,this.indexReducers=i}var t,r,n;return t=e,n=[{key:"iterator",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=e.getRangeFrom(t,r,n),o=a.startIdx,u=a.endIdx,s=o;return function(){return s<u?i(t[1][s++]):null}}},{key:"reverseIter",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;r&&(r=x(r)),n&&(n=x(n));var a=e.getRangeFrom(t,n,r),o=a.startIdx,u=a.endIdx,s=u;return function(){return s>o?i(t[1][--s]):null}}},{key:"getAllMatching",value:function(t,r){var n=e.getRangeFrom(t,r,I(r)),a=n.startIdx,i=n.endIdx;return t[1].slice(a,i)}},{key:"getRangeFrom",value:function(e){var t=d(e,1),r=t[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return{startIdx:null==n?0:v(r,n,g),endIdx:null==a?r.length:v(r,a,g)}}},{key:"getFirstMatching",value:function(t,r){return e.iterator(t,r,I(r))()}}],(r=[{key:"pkKeyer",get:function(){return this.indexKeyers[this.mainIndexName]}},{key:"setKeyer",value:function(e,t){this.indexKeyers[e]=t}},{key:"addGroupedIndex",value:function(e,t,r,n,a){if(!this.indexKeyers[r])throw new Error("Dependent index "+r+" should be defined before "+e);this.setKeyer(e,t),this.indexDependentGroup[e]=r,this.indexGroupKeyers[e]=n,this.indexReducers[e]=a}},{key:"empty",value:function(){var e={};for(var t in this.indexKeyers)e[t]=[[],[]];return e}},{key:"removeAll",value:function(e,t){return this.splice(e,t,[])}},{key:"removeByPk",value:function(t,r){return this.removeAll(t,e.getAllMatching(t[this.mainIndexName],r))}},{key:"update",value:function(t,r){var n=this,a=[],i=[],o=d(w(this.indexKeyers[this.mainIndexName],r),2),s=o[0];return o[1].forEach((function(r,o){u(e.getFirstMatching(t[n.mainIndexName],s[o]),(function(e){return a.push(e)})),i.push(r)})),this.splice(t,a,i)}},{key:"splice",value:function(t,r,n){var a=this,i=t;if(!r.length&&!n.length)return t;t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t);for(var o=function(){var o=f[d],l=t[o],p=r,y=n,h=a.indexDependentGroup[o];if(h){var b=a.indexGroupKeyers[o],g=a.indexReducers[o],v=w(b,[].concat(c(p),c(y)));p=[],y=[];var m,x=s(v[0]);try{for(x.s();!(m=x.n()).done;){var k=m.value,A=i[h],O=I(k),R=e.iterator(A,k,O),j=e.reverseIter(A,O,k),P=g(R,j),z=t[h],M=g(R=e.iterator(z,k,O),j=e.reverseIter(z,O,k));P!==M&&(u(P,(function(e){return p.push(e)})),u(M,(function(e){return y.push(e)})))}}catch(e){x.e(e)}finally{x.f()}}if(!y.length&&!p.length)return"continue";l=t[o]=[c(l[0]),c(l[1])];var N,S=s(p);try{for(S.s();!(N=S.n()).done;){var K=N.value;a.removeFromIndex(l,o,K)}}catch(e){S.e(e)}finally{S.f()}var C,D=s(y);try{for(D.s();!(C=D.n()).done;){var T=C.value;a.addToIndex(l,o,T)}}catch(e){D.e(e)}finally{D.f()}},d=0,f=Object.keys(this.indexKeyers);d<f.length;d++)o();return t}},{key:"strictValueKeyOf",value:function(e,t){var r=this.indexKeyers[this.mainIndexName](t);return e===this.mainIndexName?r:[].concat(c(this.indexKeyers[e](t)),c(r))}},{key:"addToIndex",value:function(t,r,n){var a=this.strictValueKeyOf(r,n),i=e.getRangeFrom(t,a).startIdx;t[0].splice(i,0,a),t[1].splice(i,0,n)}},{key:"removeFromIndex",value:function(t,r,n){var a=this.strictValueKeyOf(r,n),i=e.getRangeFrom(t,a,x(a)),o=i.startIdx,u=i.endIdx;t[0].splice(o,u-o),t[1].splice(o,u-o)}}])&&h(t.prototype,r),n&&h(t,n),e}();function w(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[[],[]],a=s(t);try{for(a.s();!(r=a.n()).done;){var i=r.value,o=e(i),u=m.getRangeFrom(n,o,x(o)),c=u.startIdx,l=u.endIdx;n[0].splice(c,l-c,o),n[1].splice(c,l-c,i)}}catch(e){a.e(e)}finally{a.f()}return n}function x(e){return[].concat(c(e),[null])}function I(e){return[].concat(c(e),[1/0])}function k(e){return function(e){if(Array.isArray(e))return O(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||A(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){if(e){if("string"==typeof e)return O(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?O(e,t):void 0}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function R(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?R(Object(r),!0).forEach((function(t){P(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var z={attributes:{content:"",language:"",editsComplete:!1,studyGuide:!1,terms:void 0,audioFileId:null,imageFilePaths:null,tags:[]},id:"",path:"",version:""},M=j(j({},z),{},{attributes:j(j({},z.attributes),{},{terms:[]}),id:void 0,path:void 0,version:void 0}),N={noteId:"",language:"",attributes:{reference:"",marker:"",pronounce:"",definition:"",hint:"",clozes:void 0,related:void 0}},S=(j(j({},N),{},{attributes:j(j({},N.attributes),{},{clozes:[]}),noteId:void 0,language:void 0}),{noteId:"",reference:"",marker:"",clozeIdx:-1,language:"",attributes:{type:"produce",clozed:"",schedule:{lastAnsweredMinutes:0,nextDueMinutes:0,delayIntervalMinutes:0,intervalMinutes:0,isNew:!0}}}),K=(j(j({},S),{},{attributes:j(j({},S.attributes),{},{answers:[]}),noteId:void 0,reference:void 0,marker:void 0,clozeIdx:void 0,language:void 0}),"\n===\n");function C(e){var t=j({},M);t.attributes=j({},M.attributes);var r=e.lastIndexOf(K);return-1!==r?(t.attributes=j(j({},t.attributes),JSON.parse(e.slice(r+K.length))),t.attributes.content=e.slice(0,r)):t.attributes.content=e,t}function D(e,t){return{inner:e,tag:t}}var T=new m("byLanguageTagAndNoteId");T.setKeyer("byLanguageTagAndNoteId",(function(e){var t=e.tag,r=e.inner;return[r.attributes.language,t,r.id]})),T.setKeyer("byNoteId",(function(e){return[e.inner.id]})),T.addGroupedIndex("byLangAndTagOfFirstNoteId",(function(e){var t=e.tag;return[e.inner.attributes.language,t]}),"byLanguageTagAndNoteId",(function(e){var t=e.tag;return[e.inner.attributes.language,t]}),(function(e){return e()}));var E=new m("byPath");E.setKeyer("byPath",(function(e){return e.path.split("/")})),E.setKeyer("byId",(function(e){return[e.id]})),E.setKeyer("byLanguageAndStudyGuide",(function(e){return[e.attributes.language,e.attributes.studyGuide]})),E.setKeyer("byAudioFileId",(function(e){return[e.attributes.audioFileId]})),E.setKeyer("byEditsComplete",(function(e){return[e.attributes.editsComplete]}));var F=new m("byNoteIdReferenceAndMarker");F.setKeyer("byNoteIdReferenceAndMarker",(function(e){return[e.noteId,e.attributes.reference,e.attributes.marker]})),F.setKeyer("byReference",(function(e){return[e.attributes.reference]}));var B=new m("byNoteIdReferenceMarkerAndTag");B.setKeyer("byNoteIdReferenceMarkerAndTag",(function(e){var t=e.inner,r=e.tag;return[].concat(k(F.pkKeyer(t)),[r])})),B.setKeyer("byTag",(function(e){return e.inner,[e.tag]}));var L=new m("byNoteIdAndReferenceAndMarkerAndRelatable");L.setKeyer("byNoteIdAndReferenceAndMarkerAndRelatable",(function(e){var t=e.tag,r=e.inner,n=r.attributes,a=n.reference,i=n.marker;return[r.noteId,a,i,t]})),L.setKeyer("byRelatable",(function(e){return[e.tag]}));var G=new m("byNoteIdReferenceMarkerAndClozeIdx");G.setKeyer("byNoteIdReferenceMarkerAndClozeIdx",(function(e){return[e.noteId,e.reference,e.marker,e.clozeIdx]})),G.setKeyer("byNoteIdReferenceMarkerAndNextDue",(function(e){return[e.noteId,e.reference,e.marker,e.attributes.schedule.nextDueMinutes]})),G.setKeyer("byNoteIdReferenceMarkerAndNextDue",(function(e){return[e.noteId,e.reference,e.marker,e.attributes.schedule.nextDueMinutes]}));var q=new m("byNoteIdReferenceMarkerClozeIdxAndTag");q.setKeyer("byNoteIdReferenceMarkerClozeIdxAndTag",(function(e){var t=e.inner,r=e.tag;return[].concat(k(G.pkKeyer(t)),[r])})),q.setKeyer("byTagSpokenAndNextDue",(function(e){var t=e.inner;return[e.tag,"listen"==t.attributes.type||"speak"==t.attributes.type,!t.attributes.schedule.delayIntervalMinutes,t.attributes.schedule.nextDueMinutes]})),q.setKeyer("byTagSpokenNewAndNextDue",(function(e){var t=e.inner;return[e.tag,"listen"==t.attributes.type||"speak"==t.attributes.type,t.attributes.schedule.isNew,!t.attributes.schedule.delayIntervalMinutes,t.attributes.schedule.nextDueMinutes]})),q.setKeyer("byTagSpokenReferenceAndNextDue",(function(e){var t=e.inner;return[e.tag,"listen"==t.attributes.type||"speak"==t.attributes.type,t.reference,t.attributes.schedule.nextDueMinutes]}));var $=new m("byNoteIdReferenceMarkerClozeIdxAndAnswerIdx");$.setKeyer("byNoteIdReferenceMarkerClozeIdxAndAnswerIdx",(function(e){return[e.noteId,e.reference,e.marker,e.clozeIdx,e.answerIdx>0?1:0]}));var U=new m("byNoteIdReferenceMarkerClozeIdxAnswerIdxAndTag");function V(e,t,r,n){var a,i=j(j({},e),{},{attributes:j(j({},e.attributes),{},{terms:void 0}),id:t,path:r,version:n}),o=[],u=[],s=[],c={note:i,terms:o,clozes:u,clozeAnswers:s},l=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=A(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw i}}}}(e.attributes.terms);try{for(l.s();!(a=l.n()).done;){var d=a.value,f=j(j({},d),{},{attributes:j(j({},d.attributes),{},{clozes:void 0}),language:i.attributes.language,noteId:i.id});o.push(f);for(var p=0;p<d.attributes.clozes.length;++p){var y=d.attributes.clozes[p],h=j(j({},y),{},{clozeIdx:p,marker:f.attributes.marker,reference:f.attributes.reference,language:i.attributes.language,noteId:i.id});u.push(h);for(var b=0;b<y.attributes.answers.length;++b){var g={answer:y.attributes.answers[b],answerIdx:b,clozeIdx:p,marker:f.attributes.marker,reference:f.attributes.reference,language:i.attributes.language,noteId:i.id};s.push(g)}}}}catch(e){l.e(e)}finally{l.f()}return c}U.setKeyer("byNoteIdReferenceMarkerClozeIdxAnswerIdxAndTag",(function(e){var t=e.inner,r=e.tag;return[].concat(k($.pkKeyer(t)),[r])})),U.setKeyer("byTagAndAnswered",(function(e){var t=e.inner;return[e.tag,t.answer[0]]})),$.addGroupedIndex("byLastAnsweredOfNoteIdReferenceMarkerAndClozeIdx",(function(e){return[e.answer[0]]}),"byNoteIdReferenceMarkerClozeIdxAndAnswerIdx",(function(e){return[e.noteId,e.reference,e.marker,e.clozeIdx]}),(function(e,t){return t()}));var J={notes:E.empty(),terms:F.empty(),clozes:G.empty(),clozeAnswers:$.empty(),taggedNotes:T.empty(),taggedTerms:B.empty(),taggedClozes:q.empty(),taggedClozeAnswers:U.empty(),termsRelatable:L.empty()};function H(e){for(var t=[],r=[],n=[],a=[],i=[],o=[],u=[],s=[],c=[],l=arguments.length,d=new Array(l>1?l-1:0),f=1;f<l;f++)d[f-1]=arguments[f];for(var p=function(){var l=h[y];t.push(l.note),r.push.apply(r,k(l.terms)),n.push.apply(n,k(l.clozes)),a.push.apply(a,k(l.clozeAnswers)),[l.note.attributes.language].concat(k(l.note.attributes.tags)).forEach((function(e){i.push(D(l.note,e)),o.push.apply(o,k(l.terms.map((function(t){return D(t,e)})))),s.push.apply(s,k(l.clozes.map((function(t){return D(t,e)})))),c.push.apply(c,k(l.clozeAnswers.map((function(t){return D(t,e)}))))})),l.terms.forEach((function(e){var t;null===(t=e.attributes.related)||void 0===t||t.forEach((function(t){u.push(D(e,t))}))})),e.taggedNotes=T.removeAll(e.taggedNotes,m.getAllMatching(e.taggedNotes.byNoteId,[l.note.id])),e.taggedTerms=B.removeAll(e.taggedTerms,m.getAllMatching(e.taggedTerms.byNoteIdReferenceMarkerAndTag,[l.note.id])),e.taggedClozes=q.removeAll(e.taggedClozes,m.getAllMatching(e.taggedClozes.byNoteIdReferenceMarkerClozeIdxAndTag,[l.note.id])),e.taggedClozeAnswers=U.removeAll(e.taggedClozeAnswers,m.getAllMatching(e.taggedClozeAnswers.byNoteIdReferenceMarkerClozeIdxAnswerIdxAndTag,[l.note.id])),e.terms=F.removeByPk(e.terms,[l.note.id]),e.clozes=G.removeByPk(e.clozes,[l.note.id]),e.clozeAnswers=$.removeByPk(e.clozeAnswers,[l.note.id])},y=0,h=d;y<h.length;y++)p();e.notes=E.update(e.notes,t),e.terms=F.update(e.terms,r),e.clozes=G.update(e.clozes,n),e.clozeAnswers=$.update(e.clozeAnswers,a),e.taggedNotes=T.update(e.taggedNotes,i),e.taggedClozes=q.update(e.taggedClozes,s),e.taggedTerms=B.update(e.taggedTerms,o),e.taggedClozeAnswers=U.update(e.taggedClozeAnswers,c),e.termsRelatable=L.update(e.termsRelatable,u)}function Q(e,t,r,n,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function W(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){Q(i,n,a,o,u,"next",e)}function u(e){Q(i,n,a,o,u,"throw",e)}o(void 0)}))}}function X(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Y(e,t,r){return t&&X(e.prototype,t),r&&X(e,r),e}function Z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ee=function e(){var t=this;Z(this,e),_(this,"resolve",(function(){return null})),_(this,"reject",(function(){return null})),_(this,"promise",new Promise((function(e,r){t.resolve=e,t.reject=r})))},te=function(){function e(){Z(this,e),_(this,"trigger",new ee),_(this,"closed",!1)}var t;return Y(e,[{key:"send",value:function(e){this.closed||(this.trigger.resolve(e),this.trigger=new ee)}},{key:"reject",value:function(e){this.closed||(this.trigger.reject(e),this.trigger=new ee)}},{key:"receive",value:(t=W(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.trigger.promise;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(e){this.closed||(this.trigger.resolve(e),this.closed=!0)}}]),e}(),re=function(){function e(){Z(this,e),_(this,"channel",new te),_(this,"open",!0)}var t;return Y(e,[{key:"ready",value:(t=W(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.open){e.next=11;break}return this.open=!1,e.prev=3,e.next=6,t();case 6:return e.abrupt("return",e.sent);case 7:return e.prev=7,this.channel.send(),this.open=!0,e.finish(7);case 11:return e.next=13,this.channel.receive();case 13:e.next=0;break;case 15:case"end":return e.stop()}}),e,this,[[3,,7,11]])}))),function(e){return t.apply(this,arguments)})}]),e}();function ne(e,t,r,n,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function ae(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){ne(i,n,a,o,u,"next",e)}function u(e){ne(i,n,a,o,u,"throw",e)}o(void 0)}))}}function ie(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ue(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(r),!0).forEach((function(t){se(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function se(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ce(e){var t=e.split(".");return t.length>0?i(t[t.length-1].toLowerCase()):null}var le=ue(ue(ue(ue({},{mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",opus:"audio/opus"}),{text:"text/plain; charset=UTF-8"}),{mp4:"video/mp4",ogg:"video/ogg"}),{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",svg:"image/svg+xml",gif:"image/gif",bmp:"image/bmp",tiff:"image/tiff",ico:"image/x-icon"}),de=new m("byId");function fe(e){return new Promise((function(t,r){var n=new FileReader;n.onload=function(){return t(n.result)},n.onerror=function(e){return r(n.error)},n.readAsText(e)}))}function pe(e){return e instanceof Blob?e:new Blob([e.data],{type:e.type})}function ye(e){return new Promise((function(t,r){var n=new FileReader;n.onload=function(){return t(n.result)},n.onerror=r,n.readAsArrayBuffer(e)}))}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function be(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ge(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?be(Object(r),!0).forEach((function(t){ve(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):be(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ve(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function me(e,t,r,n,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function we(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){me(i,n,a,o,u,"next",e)}function u(e){me(i,n,a,o,u,"throw",e)}o(void 0)}))}}de.setKeyer("byPath",(function(e){return e.path.split("/")})),de.setKeyer("byId",(function(e){return[e.id]})),de.setKeyer("byDirty",(function(e){return[e.dirty]}));var xe=new(function(){function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),se(this,"writeSemaphore",new re),se(this,"dirtyIndex",de.empty()),this.db=t,this.db.version(2).stores({cursors:"&backend",metadata:"&id,path,dirty,ext",blobs:"&id,path,ext,dirty"}),this.metaLoaded=this.db.table("blobs").where("dirty").above(0).toArray().then((function(e){r.dirtyIndex=de.update(r.dirtyIndex,e)}))}var t,r,i,u,s,c,l,d,f,p,y,h,b,g,v,w,x;return t=e,(r=[{key:"markDeleted",value:(x=ae(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.table("metadata").where("id").equals(t).first();case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return");case 5:return r=ue(ue({},r),{},{dirty:1,updatedAt:Date.now(),deleted:!0}),e.next=8,this.storeBlobAndMetadata(r,new Blob);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{key:"replaceFromDirty",value:function(e){var t={};return this.dirtyIndex.byId[1].map((function(e){t[e.id]=e})),e.map((function(e){if(e.id in t){var r=t[e.id];if(1===r.dirty)return r}return e}))}},{key:"fetchDirty",value:(w=ae(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.metaLoaded;case 2:return e.abrupt("return",m.getAllMatching(this.dirtyIndex.byDirty,[1]));case 3:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"updateRev",value:(v=ae(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})},{key:"fetchConflicted",value:(g=ae(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.metaLoaded;case 2:return e.abrupt("return",m.getAllMatching(this.dirtyIndex.byDirty,[2]));case 3:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"clear",value:(b=ae(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.metaLoaded;case 2:return this.dirtyIndex=de.empty(),e.next=5,this.writeSemaphore.ready(ae(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.db.table("metadata").clear();case 2:return e.next=4,t.db.table("blobs").clear();case 4:return e.next=6,t.db.table("cursors").clear();case 6:case"end":return e.stop()}}),e)}))));case 5:case"end":return e.stop()}}),e,this)}))),function(){return b.apply(this,arguments)})},{key:"storeCursor",value:(h=ae(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.writeSemaphore.ready(ae(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.db.table("cursors").put({backend:"default",cursor:t});case 2:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"getCursor",value:(y=ae(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.table("cursors").where("backend").equals("default").first();case 2:return t=e.sent,e.abrupt("return",(null==t?void 0:t.cursor)||"");case 4:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"storeBlob",value:(p=ae(regeneratorRuntime.mark((function e(t,r,a){var i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n(ce(r.path),""),o=ue(ue({},r),{},{ext:i,dirty:a?2===a?2:1:0,updatedAt:Date.now()}),e.next=4,this.storeBlobAndMetadata(o,t);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return p.apply(this,arguments)})},{key:"storeBlobAndMetadata",value:(f=ae(regeneratorRuntime.mark((function e(t,r){var i,u,s,c,l,d=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye(r);case 2:return i=e.sent,u=n((f=t.path,p=void 0,y=void 0,y=function(e){return o(le[e])},a(p=ce(f))?y(p[0]):null),r.type),s={data:i,type:u,size:r.size},c=ue(ue({},t),{},{blob:s}),e.next=8,this.metaLoaded;case 8:return l=this.writeSemaphore.ready(ae(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.db.transaction("rw!","metadata","blobs",ae(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.db.table("metadata").put(t);case 2:return e.next=4,d.db.table("blobs").put(c);case 4:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)})))),t.dirty?this.dirtyIndex=de.update(this.dirtyIndex,[c]):this.dirtyIndex=de.removeByPk(this.dirtyIndex,[c.id]),e.next=12,l;case 12:case"end":return e.stop()}var f,p,y}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"deleteId",value:(d=ae(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.metaLoaded;case 2:return this.dirtyIndex=de.removeByPk(this.dirtyIndex,[t]),e.next=5,this.writeSemaphore.ready(ae(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.db.transaction("rw!","metadata","blobs",ae(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.db.table("blobs").where("id").equals(t).delete();case 2:return e.next=4,r.db.table("metadata").where("id").equals(t).delete();case 4:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)}))));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"deletePath",value:(l=ae(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.metaLoaded;case 2:return this.dirtyIndex=de.removeAll(this.dirtyIndex,m.getAllMatching(this.dirtyIndex.byPath,t.split("/"))),e.next=5,this.writeSemaphore.ready(ae(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.db.transaction("rw!","metadata","blobs",ae(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.db.table("metadata").where("path").between(t,t+"￾",!0,!1).delete();case 2:return e.next=4,r.db.table("blobs").where("path").between(t,t+"￾",!0,!1).delete();case 4:return e.next=6,r.db.table("metadata").where("path").equalsIgnoreCase(t).delete();case 6:return e.next=8,r.db.table("blobs").where("path").equalsIgnoreCase(t).delete();case 8:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)}))));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"fetchBlob",value:(c=ae(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=m.getFirstMatching(this.dirtyIndex.byId,[t]))){e.next=3;break}return e.abrupt("return",Promise.resolve(r));case 3:return e.abrupt("return",this.db.table("blobs").where("id").equals(t).first().then(o));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"fetchBlobByPath",value:(s=ae(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=m.getFirstMatching(this.dirtyIndex.byPath,[t]))){e.next=3;break}return e.abrupt("return",Promise.resolve(r));case 3:return e.abrupt("return",this.db.table("blobs").where("path").equals(t).first().then(o));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"fetchBlobsByExt",value:(u=ae(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.db.table("blobs").where("ext").equals(t).toArray().then((function(e){return r.replaceFromDirty(e)})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"fetchMetadataByExts",value:(i=ae(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.db.table("metadata").where("ext").anyOf(t).toArray().then((function(e){return r.replaceFromDirty(e)})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})}])&&ie(t.prototype,r),e}())(new(r(9642).default)("benSrsNew")),Ie=self;Ie.onmessage=we(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=ge({},J),e.next=4,xe.fetchBlobsByExt("txt");case 4:return r=e.sent,e.next=7,Promise.all(r.map(function(){var e=we(regeneratorRuntime.mark((function e(t){var r,n,a,i,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.blob,n=t.id,a=t.rev,i=t.path,e.next=3,fe(pe(r));case 3:return o=e.sent,u=C(o),e.abrupt("return",V(u,n,i,a));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 7:n=e.sent,H.apply(void 0,[t].concat(function(e){if(Array.isArray(e))return he(e)}(a=n)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(a)||function(e,t){if(e){if("string"==typeof e)return he(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?he(e,t):void 0}}(a)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())),Ie.postMessage({indexes:t}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error(e.t0);case 15:case"end":return e.stop()}var a}),e,null,[[0,12]])})))}},n={};function a(e){var t=n[e];if(void 0!==t)return t.exports;var i=n[e]={exports:{}};return r[e](i,i.exports,a),i.exports}a.m=r,a.x=()=>{var e=a.O(void 0,[160],(()=>a(4213)));return a.O(e)},e=[],a.O=(t,r,n,i)=>{if(!r){var o=1/0;for(c=0;c<e.length;c++){for(var[r,n,i]=e[c],u=!0,s=0;s<r.length;s++)(!1&i||o>=i)&&Object.keys(a.O).every((e=>a.O[e](r[s])))?r.splice(s--,1):(u=!1,i<o&&(o=i));u&&(e.splice(c--,1),t=n())}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[r,n,i]},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,r)=>(a.f[r](e,t),t)),[])),a.u=e=>e+".js",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={213:1};a.f.i=(t,r)=>{e[t]||importScripts(a.p+a.u(t))};var t=self.webpackChunkbensrs=self.webpackChunkbensrs||[],r=t.push.bind(t);t.push=t=>{var[n,i,o]=t;for(var u in i)a.o(i,u)&&(a.m[u]=i[u]);for(o&&o(a);n.length;)e[n.pop()]=1;r(t)}})(),t=a.x,a.x=()=>a.e(160).then(t),a.x()})();