(()=>{"use strict";var e,t,r={4213:(e,t,r)=>{function n(e,t){return null==e?t:e[0]}function a(e){return null!=e}function i(e){return[e]}function o(e){return null==e?null:[e]}function u(e,t){return a(e)?[t(e[0])]:null}function s(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=p(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw i}}}}function c(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,i=[],o=!0,u=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){u=!0,a=e}finally{try{o||null==r.return||r.return()}finally{if(u)throw a}}return i}}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(e,t):void 0}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t){for(var r=0;r<e.length&&r<t.length;++r){var n=e[r],a=t[r];if(n!==a)return a===1/0?-1:n===1/0?1:null==n?-1:null==a?1:n<a?-1:1}return e.length===t.length?0:e.length>t.length?1:-1}function m(e,t,r){for(var n,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.length;a<i;)r(t,e[n=a+i>>>1])>0?a=n+1:i=n;return a}r(5666);var g=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};y(this,e),this.mainIndexName=t,this.indexKeyers=r,this.indexDependentGroup=n,this.indexGroupKeyers=a,this.indexReducers=i}var t,r,n;return t=e,n=[{key:"iterator",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=e.getRangeFrom(t,r,n),o=a.startIdx,u=a.endIdx,s=o;return function(){return s<u?i(t[1][s++]):null}}},{key:"reverseIter",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;r&&(r=x(r)),n&&(n=x(n));var a=e.getRangeFrom(t,n,r),o=a.startIdx,u=a.endIdx,s=u;return function(){return s>o?i(t[1][--s]):null}}},{key:"getAllMatching",value:function(t,r){var n=e.getRangeFrom(t,r,I(r)),a=n.startIdx,i=n.endIdx;return t[1].slice(a,i)}},{key:"getRangeFrom",value:function(e){var t=f(e,1),r=t[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return{startIdx:null==n?0:m(r,n,v),endIdx:null==a?r.length:m(r,a,v)}}},{key:"getFirstMatching",value:function(t,r){return e.iterator(t,r,I(r))()}}],(r=[{key:"setKeyer",value:function(e,t){this.indexKeyers[e]=t}},{key:"addGroupedIndex",value:function(e,t,r,n,a){if(!this.indexKeyers[r])throw new Error("Dependent index "+r+" should be defined before "+e);this.setKeyer(e,t),this.indexDependentGroup[e]=r,this.indexGroupKeyers[e]=n,this.indexReducers[e]=a}},{key:"empty",value:function(){var e={};for(var t in this.indexKeyers)e[t]=[[],[]];return e}},{key:"removeAll",value:function(e,t){return this.splice(e,t,[])}},{key:"removeByPk",value:function(t,r){return this.removeAll(t,e.getAllMatching(t[this.mainIndexName],r))}},{key:"update",value:function(t,r){var n=this,a=[],i=[],o=f(w(this.indexKeyers[this.mainIndexName],r),2),s=o[0];return o[1].forEach((function(r,o){u(e.getFirstMatching(t[n.mainIndexName],s[o]),(function(e){return a.push(e)})),i.push(r)})),this.splice(t,a,i)}},{key:"splice",value:function(t,r,n){var a=this,i=t;if(!r.length&&!n.length)return t;t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t);for(var o=function(){var o=p[f],l=t[o],d=r,h=n,y=a.indexDependentGroup[o];if(y){var b=a.indexGroupKeyers[o],v=a.indexReducers[o],m=w(b,[].concat(c(d),c(h)));d=[],h=[];var g,x=s(m[0]);try{for(x.s();!(g=x.n()).done;){var k=g.value,O=i[y],j=I(k),A=e.iterator(O,k,j),R=e.reverseIter(O,j,k),P=v(A,R),S=t[y],z=v(A=e.iterator(S,k,j),R=e.reverseIter(S,j,k));P!==z&&(u(P,(function(e){return d.push(e)})),u(z,(function(e){return h.push(e)})))}}catch(e){x.e(e)}finally{x.f()}}if(!h.length&&!d.length)return"continue";l=t[o]=[c(l[0]),c(l[1])];var D,M=s(d);try{for(M.s();!(D=M.n()).done;){var K=D.value;a.removeFromIndex(l,o,K)}}catch(e){M.e(e)}finally{M.f()}var E,N=s(h);try{for(N.s();!(E=N.n()).done;){var C=E.value;a.addToIndex(l,o,C)}}catch(e){N.e(e)}finally{N.f()}},f=0,p=Object.keys(this.indexKeyers);f<p.length;f++)o();return t}},{key:"strictValueKeyOf",value:function(e,t){var r=this.indexKeyers[this.mainIndexName](t);return e===this.mainIndexName?r:[].concat(c(this.indexKeyers[e](t)),c(r))}},{key:"addToIndex",value:function(t,r,n){var a=this.strictValueKeyOf(r,n),i=e.getRangeFrom(t,a).startIdx;t[0].splice(i,0,a),t[1].splice(i,0,n)}},{key:"removeFromIndex",value:function(t,r,n){var a=this.strictValueKeyOf(r,n),i=e.getRangeFrom(t,a,x(a)),o=i.startIdx,u=i.endIdx;t[0].splice(o,u-o),t[1].splice(o,u-o)}}])&&b(t.prototype,r),n&&b(t,n),e}();function w(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[[],[]],a=s(t);try{for(a.s();!(r=a.n()).done;){var i=r.value,o=e(i),u=g.getRangeFrom(n,o,x(o)),c=u.startIdx,l=u.endIdx;n[0].splice(c,l-c,o),n[1].splice(c,l-c,i)}}catch(e){a.e(e)}finally{a.f()}return n}function x(e){return[].concat(c(e),[null])}function I(e){return[].concat(c(e),[1/0])}function k(e){return function(e){if(Array.isArray(e))return j(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||O(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){if(e){if("string"==typeof e)return j(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?j(e,t):void 0}}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function R(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach((function(t){P(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var S={attributes:{content:"This would be new note",language:"",editsComplete:!1,terms:void 0,audioFileId:null},id:"",path:"",version:""},z=R(R({},S),{},{attributes:R(R({},S.attributes),{},{terms:[]}),id:void 0,path:void 0,version:void 0}),D={noteId:"",language:"",attributes:{reference:"",marker:"",pronounce:"",definition:"",hint:"",clozes:void 0}},M=(R(R({},D),{},{attributes:R(R({},D.attributes),{},{clozes:[]}),noteId:void 0,language:void 0}),{noteId:"",reference:"",marker:"",clozeIdx:-1,language:"",attributes:{type:"produce",clozed:"",schedule:{lastAnsweredMinutes:0,nextDueMinutes:0,delayIntervalMinutes:0,intervalMinutes:0,isNew:!0}}}),K=(R(R({},M),{},{attributes:R(R({},M.attributes),{},{answers:[]}),noteId:void 0,reference:void 0,marker:void 0,clozeIdx:void 0,language:void 0}),"\n===\n");function E(e){var t=R({},z);t.attributes=R({},z.attributes);var r=e.lastIndexOf(K);return-1!==r?(t.attributes=JSON.parse(e.slice(r+K.length)),t.attributes.content=e.slice(0,r)):t.attributes.content=e,t}var N=new g("byPath");N.setKeyer("byPath",(function(e){return e.path.split("/")})),N.setKeyer("byId",(function(e){return[e.id]})),N.setKeyer("byLanguage",(function(e){return[e.attributes.language]})),N.setKeyer("byAudioFileId",(function(e){return[e.attributes.audioFileId]})),N.setKeyer("byEditsComplete",(function(e){return[e.attributes.editsComplete]}));var C=new g("byNoteIdReferenceAndMarker");C.setKeyer("byNoteIdReferenceAndMarker",(function(e){return[e.noteId,e.attributes.reference,e.attributes.marker]})),C.setKeyer("byLanguage",(function(e){return[e.language]}));var F=new g("byNoteIdReferenceMarkerAndClozeIdx");F.setKeyer("byNoteIdReferenceMarkerAndClozeIdx",(function(e){return[e.noteId,e.reference,e.marker,e.clozeIdx]})),F.setKeyer("byLanguageSpokenAndNextDue",(function(e){return[e.language,"listen"==e.attributes.type||"speak"==e.attributes.type,!e.attributes.schedule.delayIntervalMinutes,e.attributes.schedule.nextDueMinutes]})),F.setKeyer("byLanguageSpokenNewAndNextDue",(function(e){return[e.language,"listen"==e.attributes.type||"speak"==e.attributes.type,e.attributes.schedule.isNew,!e.attributes.schedule.delayIntervalMinutes,e.attributes.schedule.nextDueMinutes]})),F.setKeyer("byNextDue",(function(e){return[!e.attributes.schedule.delayIntervalMinutes,e.attributes.schedule.nextDueMinutes]}));var B=new g("byNoteIdReferenceMarkerClozeIdxAndAnswerIdx");function T(e,t,r,n){var a,i=R(R({},e),{},{attributes:R(R({},e.attributes),{},{terms:void 0}),id:t,path:r,version:n}),o=[],u=[],s=[],c={note:i,terms:o,clozes:u,clozeAnswers:s},l=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=O(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw i}}}}(e.attributes.terms);try{for(l.s();!(a=l.n()).done;){var d=a.value,f=R(R({},d),{},{attributes:R(R({},d.attributes),{},{clozes:void 0}),language:i.attributes.language,noteId:i.id});o.push(f);for(var p=0;p<d.attributes.clozes.length;++p){var h=d.attributes.clozes[p],y=R(R({},h),{},{clozeIdx:p,marker:f.attributes.marker,reference:f.attributes.reference,language:i.attributes.language,noteId:i.id});u.push(y);for(var b=0;b<h.attributes.answers.length;++b){var v={answer:h.attributes.answers[b],answerIdx:b,clozeIdx:p,marker:f.attributes.marker,reference:f.attributes.reference,language:i.attributes.language,noteId:i.id};s.push(v)}}}}catch(e){l.e(e)}finally{l.f()}return c}B.setKeyer("byNoteIdReferenceMarkerClozeIdxAndAnswerIdx",(function(e){return[e.noteId,e.reference,e.marker,e.clozeIdx,e.answerIdx>0?1:0]})),B.setKeyer("byLanguageAndAnswered",(function(e){return[e.language,e.answer[0]]})),B.addGroupedIndex("byFirstAnsweredOfNoteIdReferenceMarkerAndClozeIdx",(function(e){return[e.answer[0]]}),"byNoteIdReferenceMarkerClozeIdxAndAnswerIdx",(function(e){return[e.noteId,e.reference,e.marker,e.clozeIdx]}),(function(e,t){return e()})),B.addGroupedIndex("byLastAnsweredOfNoteIdReferenceMarkerAndClozeIdx",(function(e){return[e.answer[0]]}),"byNoteIdReferenceMarkerClozeIdxAndAnswerIdx",(function(e){return[e.noteId,e.reference,e.marker,e.clozeIdx]}),(function(e,t){return t()}));var L={notes:N.empty(),terms:C.empty(),clozes:F.empty(),clozeAnswers:B.empty()};function q(e){for(var t=[],r=[],n=[],a=[],i=arguments.length,o=new Array(i>1?i-1:0),u=1;u<i;u++)o[u-1]=arguments[u];for(var s=0,c=o;s<c.length;s++){var l=c[s];t.push(l.note),r.push.apply(r,k(l.terms)),n.push.apply(n,k(l.clozes)),a.push.apply(a,k(l.clozeAnswers)),e.terms=C.removeByPk(e.terms,[l.note.id]),e.clozes=F.removeByPk(e.clozes,[l.note.id]),e.clozeAnswers=B.removeByPk(e.clozeAnswers,[l.note.id])}e.notes=N.update(e.notes,t),e.terms=C.update(e.terms,r),e.clozes=F.update(e.clozes,n),e.clozeAnswers=B.update(e.clozeAnswers,a)}function G(e,t,r,n,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function $(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){G(i,n,a,o,u,"next",e)}function u(e){G(i,n,a,o,u,"throw",e)}o(void 0)}))}}function U(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function V(e,t,r){return t&&U(e.prototype,t),r&&U(e,r),e}function J(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Q=function e(){var t=this;J(this,e),H(this,"resolve",(function(){return null})),H(this,"reject",(function(){return null})),H(this,"promise",new Promise((function(e,r){t.resolve=e,t.reject=r})))},W=function(){function e(){J(this,e),H(this,"trigger",new Q),H(this,"closed",!1)}var t;return V(e,[{key:"send",value:function(e){this.closed||(this.trigger.resolve(e),this.trigger=new Q)}},{key:"reject",value:function(e){this.closed||(this.trigger.reject(e),this.trigger=new Q)}},{key:"receive",value:(t=$(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.trigger.promise;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(e){this.trigger.resolve(e),this.closed=!0}}]),e}(),X=function(){function e(){J(this,e),H(this,"channel",new W),H(this,"open",!0)}var t;return V(e,[{key:"ready",value:(t=$(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.open){e.next=11;break}return this.open=!1,e.prev=3,e.next=6,t();case 6:return e.abrupt("return",e.sent);case 7:return e.prev=7,this.channel.send(),this.open=!0,e.finish(7);case 11:return e.next=13,this.channel.receive();case 13:e.next=0;break;case 15:case"end":return e.stop()}}),e,this,[[3,,7,11]])}))),function(e){return t.apply(this,arguments)})}]),e}();function Y(e,t,r,n,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function Z(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){Y(i,n,a,o,u,"next",e)}function u(e){Y(i,n,a,o,u,"throw",e)}o(void 0)}))}}function _(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function te(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(r),!0).forEach((function(t){re(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ee(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function re(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ne(e){var t=e.split(".");return t.length>0?i(t[t.length-1]):null}var ae=te(te(te({},{mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",opus:"audio/opus"}),{text:"text/plain; charset=UTF-8"}),{mp4:"video/mp4",ogg:"video/ogg"}),ie=new g("byId");function oe(e){return new Promise((function(t,r){var n=new FileReader;n.onload=function(){return t(n.result)},n.onerror=function(e){return r(n.error)},n.readAsText(e)}))}function ue(e){return e instanceof Blob?e:new Blob([e.data],{type:e.type})}function se(e){return new Promise((function(t,r){var n=new FileReader;n.onload=function(){return t(n.result)},n.onerror=r,n.readAsArrayBuffer(e)}))}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function de(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?le(Object(r),!0).forEach((function(t){fe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):le(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function fe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pe(e,t,r,n,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function he(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){pe(i,n,a,o,u,"next",e)}function u(e){pe(i,n,a,o,u,"throw",e)}o(void 0)}))}}ie.setKeyer("byPath",(function(e){return e.path.split("/")})),ie.setKeyer("byId",(function(e){return[e.id]}));var ye=new(function(){function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),re(this,"writeSemaphore",new X),re(this,"dirtyIndex",ie.empty()),this.db=t,this.db.version(2).stores({cursors:"&backend",metadata:"&id,path,dirty,ext",blobs:"&id,path,ext,dirty"}),this.dirtiesLoaded=this.db.table("blobs").where("dirty").equals(1).toArray().then((function(e){r.dirtyIndex=ie.update(r.dirtyIndex,e)}))}var t,r,i,u,s,c,l,d,f,p,h,y,b,v;return t=e,(r=[{key:"markDeleted",value:(v=Z(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.table("metadata").where("id").equals(t).first();case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return");case 5:return r=te(te({},r),{},{dirty:1,updatedAt:Date.now(),deleted:!0}),e.next=8,this.storeBlobAndMetadata(r,new Blob);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"replaceFromDirty",value:function(e){var t={};return this.dirtyIndex.byId[1].map((function(e){t[e.id]=e})),e.map((function(e){return e.id in t?t[e.id]:e}))}},{key:"fetchDirty",value:(b=Z(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dirtiesLoaded;case 2:return e.abrupt("return",this.dirtyIndex.byId[1]);case 3:case"end":return e.stop()}}),e,this)}))),function(){return b.apply(this,arguments)})},{key:"clear",value:(y=Z(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.dirtyIndex=ie.empty(),e.next=3,this.dirtiesLoaded;case 3:return e.next=5,this.writeSemaphore.ready(Z(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.db.table("metadata").clear();case 2:return e.next=4,t.db.table("blobs").clear();case 4:return e.next=6,t.db.table("cursors").clear();case 6:case"end":return e.stop()}}),e)}))));case 5:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"storeCursor",value:(h=Z(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.writeSemaphore.ready(Z(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.db.table("cursors").put({backend:"default",cursor:t});case 2:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"getCursor",value:(p=Z(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.table("cursors").where("backend").equals("default").first();case 2:return t=e.sent,e.abrupt("return",(null==t?void 0:t.cursor)||"");case 4:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"storeBlob",value:(f=Z(regeneratorRuntime.mark((function e(t,r,a){var i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n(ne(r.path),""),o=te(te({},r),{},{ext:i,dirty:a?1:0,updatedAt:Date.now()}),e.next=4,this.storeBlobAndMetadata(o,t);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return f.apply(this,arguments)})},{key:"storeBlobAndMetadata",value:(d=Z(regeneratorRuntime.mark((function e(t,r){var i,u,s,c,l,d=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,se(r);case 2:return i=e.sent,u=n((f=t.path,p=void 0,h=void 0,h=function(e){return o(ae[e.toLowerCase()])},a(p=ne(f))?h(p[0]):null),r.type),s={data:i,type:u,size:r.size},c=te(te({},t),{},{blob:s}),e.next=8,this.dirtiesLoaded;case 8:if(l=this.writeSemaphore.ready(Z(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.db.transaction("rw!","metadata","blobs",Z(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.db.table("metadata").put(t);case 2:return e.next=4,d.db.table("blobs").put(c);case 4:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)})))),!t.dirty){e.next=12;break}return this.dirtyIndex=ie.update(this.dirtyIndex,[c]),e.abrupt("return");case 12:return this.dirtyIndex=ie.removeByPk(this.dirtyIndex,[c.id]),e.next=15,l;case 15:case"end":return e.stop()}var f,p,h}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"deleteId",value:(l=Z(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dirtiesLoaded;case 2:return this.dirtyIndex=ie.removeByPk(this.dirtyIndex,[t]),e.next=5,this.writeSemaphore.ready(Z(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.db.transaction("rw!","metadata","blobs",Z(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.db.table("blobs").where("id").equals(t).delete();case 2:return e.next=4,r.db.table("metadata").where("id").equals(t).delete();case 4:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)}))));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"deletePath",value:(c=Z(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dirtiesLoaded;case 2:return this.dirtyIndex=ie.removeAll(this.dirtyIndex,g.getAllMatching(this.dirtyIndex.byPath,t.split("/"))),e.next=5,this.writeSemaphore.ready(Z(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.db.transaction("rw!","metadata","blobs",Z(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.db.table("metadata").where("path").between(t,t+"￾",!0,!1).delete();case 2:return e.next=4,r.db.table("blobs").where("path").between(t,t+"￾",!0,!1).delete();case 4:return e.next=6,r.db.table("metadata").where("path").equalsIgnoreCase(t).delete();case 6:return e.next=8,r.db.table("blobs").where("path").equalsIgnoreCase(t).delete();case 8:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)}))));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"fetchBlob",value:(s=Z(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=g.getFirstMatching(this.dirtyIndex.byId,[t]))){e.next=3;break}return e.abrupt("return",Promise.resolve(r));case 3:return e.abrupt("return",this.db.table("blobs").where("id").equals(t).first().then(o));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"fetchBlobsByExt",value:(u=Z(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.db.table("blobs").where("ext").equals(t).toArray().then((function(e){return r.replaceFromDirty(e)})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"fetchMetadataByExts",value:(i=Z(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.db.table("metadata").where("ext").anyOf(t).toArray().then((function(e){return r.replaceFromDirty(e)})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})}])&&_(t.prototype,r),e}())(new(r(9642).default)("benSrsNew")),be=self;be.onmessage=he(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=de({},L),e.next=4,ye.fetchBlobsByExt("txt");case 4:return r=e.sent,e.next=7,Promise.all(r.map(function(){var e=he(regeneratorRuntime.mark((function e(t){var r,n,a,i,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.blob,n=t.id,a=t.rev,i=t.path,e.next=3,oe(ue(r));case 3:return o=e.sent,u=E(o),e.abrupt("return",T(u,n,i,a));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 7:n=e.sent,q.apply(void 0,[t].concat(function(e){if(Array.isArray(e))return ce(e)}(a=n)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(a)||function(e,t){if(e){if("string"==typeof e)return ce(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ce(e,t):void 0}}(a)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())),be.postMessage({indexes:t}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error(e.t0);case 15:case"end":return e.stop()}var a}),e,null,[[0,12]])})))}},n={};function a(e){var t=n[e];if(void 0!==t)return t.exports;var i=n[e]={exports:{}};return r[e](i,i.exports,a),i.exports}a.m=r,a.x=()=>{var e=a.O(void 0,[160],(()=>a(4213)));return a.O(e)},e=[],a.O=(t,r,n,i)=>{if(!r){var o=1/0;for(c=0;c<e.length;c++){for(var[r,n,i]=e[c],u=!0,s=0;s<r.length;s++)(!1&i||o>=i)&&Object.keys(a.O).every((e=>a.O[e](r[s])))?r.splice(s--,1):(u=!1,i<o&&(o=i));u&&(e.splice(c--,1),t=n())}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[r,n,i]},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,r)=>(a.f[r](e,t),t)),[])),a.u=e=>e+".js",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={213:1};a.f.i=(t,r)=>{e[t]||importScripts(a.p+a.u(t))};var t=self.webpackChunk=self.webpackChunk||[],r=t.push.bind(t);t.push=t=>{var[n,i,o]=t;for(var u in i)a.o(i,u)&&(a.m[u]=i[u]);for(o&&o(a);n.length;)e[n.pop()]=1;r(t)}})(),t=a.x,a.x=()=>a.e(160).then(t),a.x()})();